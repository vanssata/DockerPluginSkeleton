#!/bin/bash
run_command(){
  container_name=$1
  func=$2
  echo "Start ${func}"
  docker-compose exec ${container_name} bash -c "${func}"
  if [ $? -eq 0 ]; then
    echo "End ${func}"
  else
    echo "Error in ${func}"
    exit 1;
  fi
}

function init() {
  run_command php-fpm 'composer install'
  run_command php-fpm '(cd tests/Application && bin/console doct:mig:migr -q --allow-no-migration --all-or-nothing)'
  run_command php-fpm '(cd tests/Application && bin/console sylius:fixtures:load -e dev)'
  run_command php-fpm '(cd tests/Application && yarn && yarn build)'
}

function run() {
  env="${1:-dev}"
  ip="${2:-0.0.0.0}"
  prort="${3:-80}"
  run_command php-fpm "(cd tests/Application && yarn && yarn build)"
  echo "================================================================================================================="
  run_command php-fpm "(cd tests/Application && ./bin/console server:start ${ip}:${prort} -d public -e ${env})"
}

dir=$(basename $PWD)
export PS1='(${dir}-ENV)\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '

